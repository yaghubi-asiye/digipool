!function(e){e.fn.digitbox=function(t){if(this.length>1)return void this.each(function(){e(this).digitbox(t)});var a={truevalue:!1,minvalue:!1,maxvalue:!1,digitcount:!1,grouping:!1,separator:",",grouplength:3,"float":!1};t&&e.extend(a,t),a.separator.length>1&&(a.separator=a.separator.substr(0,1)),a["float"]&&a.grouping&&"."==a.separator&&(a.separator=",");var n=this,r="",l=function(e){"undefined"==typeof e.preventDefault?(window.event.cancelBubble=!0,window.event.returnValue=!1):e.preventDefault()},u=function(){var e=0;if(document.selection){n[0].focus();var t=document.selection.createRange();t.moveStart("character",-n[0].value.length),e=t.text.length}else(n[0].selectionStart||"0"==n[0].selectionStart)&&(e=n[0].selectionStart);return e},o=function(e){if(n[0].setSelectionRange)n[0].setSelectionRange(e,e);else if(n[0].createTextRange){var t=n[0].createTextRange();t.collapse(!0),t.moveEnd("character",e),t.moveStart("character",e),t.select()}},i=function(){return-1==n.val().indexOf(".")&&""!=n.val()?!0:!1},v=function(){return a.grouping?-1!=n.val().indexOf(a.separator):!1},c=function(t){var n="undefined"==typeof t.which?"undefined"==typeof t.keyCode?!1:t.keyCode:t.which;a.truevalue&&0==u()&&48==n&&l(t),n!==!1&&(t.ctrlKey||n>=48&&57>=n||e.inArray(n,[0,8,13])>-1||a["float"]&&46==n&&i()&&!v())||l(t)},g=function(t){if("function"==typeof t.charCodeAt){for(var n=0,r=-1;n<t.length;){if(-1==e.inArray(t.charCodeAt(n),[48,a.separator.charCodeAt(0)])){r=n;break}n++}return-1==r?"":t.substr(r)}return""},f=function(e,t){var r=e.split("");if("object"==typeof r){for(var l=r.length,u=!1,o=0,i=new Array,v="",c=r.length-1;c>=0;c--)o++,v=r[c]+v,(o==a.grouplength||0==c)&&(o==a.grouplength&&l>a.grouplength&&(u=!0),o=0,i.unshift(v),v="");if(1==u||e.length<=a.grouplength){if(t)return i.join(a.separator);n[0].value=i.join(a.separator)}}},p=function(){var e=n[0].value.replace(new RegExp("\\"+a.separator,"g"),"").replace(/\,/g,"");f(e,!1)},h=function(e,t){"number"!=typeof t&&(t=0);for(var a="",n=0;t>n;n++)a+=e;return a},s=function(){var e=(n[0].value.match(/\./g)||[]).length;if(e>1){var t=n[0].value.split(".");if("object"==typeof t){for(var a="",r=0,l=0;l<t.length;l++)""!=t[l]&&(a+=(1==r?".":"")+t[l],r++);n[0].value=a}else n[0].value=""}},d=function(){r=n.val(),window.setInterval(function(){if("function"==typeof n[0].value.match&&n.val()!=r){var e=u();a["float"]?(n[0].value=n[0].value.match(/[0-9\.]+/g),s()):n[0].value=n[0].value.match(/\d+/g),"null"==n[0].value&&(n[0].value=""),a.truevalue&&(n[0].value=g(n.val())),a.grouping&&i()&&p();var t=n[0].value.length,l=r.length,v=t>l?t-l-1:0;o(e+v),r=n.val()}},5)},m=function(){var e=new RegExp("\\"+a.separator,"g");a.minvalue!==!1&&g(n.val().replace(e,""))<parseInt(a.minvalue)&&n.val(parseInt(a.minvalue)),a.maxvalue!==!1&&g(n.val().replace(e,""))>parseInt(a.maxvalue)&&n.val(parseInt(a.maxvalue)),a.digitcount!==!1&&n.val().replace(e,"").length<a.digitcount&&n.val(h("0",a.digitcount-n.val().replace(e,"").length)+n.val().replace(e,""))};if(a.truevalue&&n.val(g(n.val())),a.grouping&&i()&&p(),(a.minvalue||a.maxvalue||a.digitcount)&&this.blur(function(e){m()}),this.keypress(c),d(),a.grouping&&i()&&"undefined"!=typeof n.attr("maxlength")){var x=parseInt(n.attr("maxlength"));x>a.grouplength&&n.attr("maxlength",f(h("1",x),!0).length)}return m(),this}}(jQuery);